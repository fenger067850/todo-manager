# ğŸš€ Claude Code å…¨æ ˆå¾…åŠäº‹é¡¹ç®¡ç†ç³»ç»Ÿ + äº‘ç›˜å­˜å‚¨å¼€å‘æ•™ç¨‹

> ğŸŒŸ **åˆ›æ–°ç‰¹è‰²**ï¼šè¿™ä¸ä»…ä»…æ˜¯ä¸€ä¸ªå¾…åŠäº‹é¡¹ç®¡ç†ç³»ç»Ÿï¼Œæ›´æ˜¯ä¸€ä¸ªé›†æˆäº‘ç›˜å­˜å‚¨çš„æ™ºèƒ½å·¥ä½œå¹³å°ï¼æ¯ä¸ªä»»åŠ¡éƒ½å¯ä»¥å…³è”å’Œç®¡ç†æ–‡ä»¶é™„ä»¶ï¼Œè®©ä»»åŠ¡ç®¡ç†æ›´åŠ é«˜æ•ˆå’Œå®Œæ•´ã€‚

> ä»é›¶å¼€å§‹ï¼Œä½¿ç”¨ Claude Code æ„å»ºä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„ç°ä»£åŒ–å¾…åŠäº‹é¡¹ç®¡ç†ç³»ç»Ÿ

## ğŸ“– ç›®å½•

1. [é¡¹ç›®ç‰¹è‰²äº®ç‚¹](#é¡¹ç›®ç‰¹è‰²äº®ç‚¹)
2. [æŠ€æœ¯æ ˆä»‹ç»](#æŠ€æœ¯æ ˆä»‹ç»)
3. [å¼€å‘ç¯å¢ƒå‡†å¤‡](#å¼€å‘ç¯å¢ƒå‡†å¤‡)
4. [é¡¹ç›®åˆå§‹åŒ–](#é¡¹ç›®åˆå§‹åŒ–)
5. [æ•°æ®åº“è®¾è®¡](#æ•°æ®åº“è®¾è®¡)
6. [åç«¯APIå¼€å‘](#åç«¯apiå¼€å‘)
7. [å‰ç«¯é¡µé¢å¼€å‘](#å‰ç«¯é¡µé¢å¼€å‘)
8. [äº‘ç›˜å­˜å‚¨åŠŸèƒ½](#äº‘ç›˜å­˜å‚¨åŠŸèƒ½)
9. [æ ¸å¿ƒåŠŸèƒ½å®ç°](#æ ¸å¿ƒåŠŸèƒ½å®ç°)
10. [æ ·å¼ä¸UIè®¾è®¡](#æ ·å¼ä¸uiè®¾è®¡)
11. [éƒ¨ç½²é…ç½®](#éƒ¨ç½²é…ç½®)
12. [Claude Code ä½¿ç”¨æŠ€å·§](#claude-code-ä½¿ç”¨æŠ€å·§)

---

## âœ¨ é¡¹ç›®ç‰¹è‰²äº®ç‚¹

### ğŸ¯ **åˆ›æ–°åŠŸèƒ½ï¼šä»»åŠ¡ + äº‘ç›˜åŒæ¨¡å¼ç®¡ç†**

è¿™ä¸æ˜¯ä¸€ä¸ªæ™®é€šçš„å¾…åŠäº‹é¡¹ç®¡ç†ç³»ç»Ÿï¼æˆ‘ä»¬å°†ä»»åŠ¡ç®¡ç†ä¸äº‘ç›˜å­˜å‚¨å®Œç¾ç»“åˆï¼Œåˆ›é€ å‡ºä¸€ä¸ªå…¨æ–°çš„å·¥ä½œæ•ˆç‡å¹³å°ï¼š

#### ğŸ“‹ **æ™ºèƒ½ä»»åŠ¡ç®¡ç†**

- âœ… **ç”¨æˆ·è®¤è¯ç³»ç»Ÿ** - æ³¨å†Œã€ç™»å½•ã€JWTè®¤è¯
- âœ… **ä»»åŠ¡ç®¡ç†** - åˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤ã€å®Œæˆä»»åŠ¡
- âœ… **å››è±¡é™åˆ†ç±»** - åŸºäºé‡è¦æ€§å’Œç´§æ€¥æ€§çš„ä»»åŠ¡åˆ†ç±»
- âœ… **ä¼˜å…ˆçº§ç®¡ç†** - é«˜ã€ä¸­ã€ä½ä¸‰çº§ä¼˜å…ˆçº§
- âœ… **æˆªæ­¢æ—¥æœŸ** - ä»»åŠ¡æ—¶é—´ç®¡ç†å’Œæé†’
- âœ… **åˆ†ç±»ç®¡ç†** - è‡ªå®šä¹‰ä»»åŠ¡åˆ†ç±»å’Œé¢œè‰²æ ‡è®°
- âœ… **æœˆå†è§†å›¾** - ç›´è§‚çš„æœˆå†ç•Œé¢æ˜¾ç¤ºä»»åŠ¡
- âœ… **æé†’åŠŸèƒ½** - ä»»åŠ¡æé†’å’Œé€šçŸ¥

#### â˜ï¸ **é›†æˆäº‘ç›˜å­˜å‚¨**

- ğŸ“ **æ–‡ä»¶å…³è”** - æ¯ä¸ªä»»åŠ¡éƒ½å¯ä»¥å…³è”å¤šä¸ªæ–‡ä»¶é™„ä»¶
- ğŸ“ **å¤šæ ¼å¼æ”¯æŒ** - Wordã€Excelã€PowerPointã€PDFã€TXTå…¨æ ¼å¼æ”¯æŒ
- ğŸ”’ **å®‰å…¨å­˜å‚¨** - æ–‡ä»¶åŠ å¯†å­˜å‚¨ï¼Œç”¨æˆ·éš”ç¦»è®¿é—®
- â¬†ï¸ **æ‹–æ‹½ä¸Šä¼ ** - æ”¯æŒæ‹–æ‹½ä¸Šä¼ å’Œæ‰¹é‡ä¸Šä¼ 
- ğŸ‘€ **åœ¨çº¿é¢„è§ˆ** - æ–‡ä»¶åœ¨çº¿é¢„è§ˆå’Œå¿«é€Ÿä¸‹è½½
- ğŸ“Š **å­˜å‚¨ç»Ÿè®¡** - ä¸ªäººå­˜å‚¨ç©ºé—´ä½¿ç”¨æƒ…å†µç»Ÿè®¡
- ğŸ—‚ï¸ **æ–‡ä»¶ç®¡ç†** - æ–‡ä»¶é‡å‘½åã€åˆ é™¤ã€åˆ†äº«åŠŸèƒ½

#### ğŸš€ **ç‹¬ç‰¹ä¼˜åŠ¿**

- **ğŸ¯ ä»»åŠ¡é©±åŠ¨** - ä»¥ä»»åŠ¡ä¸ºä¸­å¿ƒçš„æ–‡ä»¶ç®¡ç†ï¼Œè®©æ¯ä¸ªæ–‡ä»¶éƒ½æœ‰æ˜ç¡®çš„ä¸šåŠ¡å…³è”
- **ğŸ“ˆ å·¥ä½œæµä¼˜åŒ–** - ä»»åŠ¡è¿›åº¦ä¸ç›¸å…³æ–‡ä»¶åŒæ­¥ç®¡ç†ï¼Œæé«˜å·¥ä½œæ•ˆç‡
- **ğŸ” å¿«é€Ÿæ£€ç´¢** - é€šè¿‡ä»»åŠ¡å¿«é€Ÿå®šä½ç›¸å…³æ–‡ä»¶ï¼Œå‘Šåˆ«æ–‡ä»¶æ··ä¹±
- **ğŸ’¾ æ°¸ä¹…ä¿å­˜** - ä»»åŠ¡å®Œæˆåçš„æ–‡ä»¶ä»ç„¶ä¿ç•™ï¼Œå½¢æˆçŸ¥è¯†åº“
- **ğŸ“± ç§»åŠ¨å‹å¥½** - å®Œå…¨å“åº”å¼è®¾è®¡ï¼Œéšæ—¶éšåœ°ç®¡ç†ä»»åŠ¡å’Œæ–‡ä»¶

### ğŸ“± ç”¨æˆ·ç•Œé¢

- **ä»ªè¡¨æ¿** - ä»»åŠ¡æ¦‚è§ˆå’Œå­˜å‚¨ç»Ÿè®¡
- **å››è±¡é™è§†å›¾** - æ—¶é—´ç®¡ç†çŸ©é˜µ + æ–‡ä»¶é¢„è§ˆ
- **æœˆå†è§†å›¾** - å¯è§†åŒ–ä»»åŠ¡æ—¶é—´çº¿ + é™„ä»¶æ ‡è®°
- **äº‘ç›˜ä¸­å¿ƒ** - ç‹¬ç«‹çš„æ–‡ä»¶ç®¡ç†ä¸­å¿ƒ
- **è®¾ç½®é¡µé¢** - ä¸ªäººè®¾ç½®å’Œå­˜å‚¨é…ç½®

### ğŸ¨ **ç”¨æˆ·ä½“éªŒåˆ›æ–°**

- **æ™ºèƒ½å…³è”** - è‡ªåŠ¨è¯†åˆ«æ–‡ä»¶ç±»å‹ï¼ŒåŒ¹é…å¯¹åº”å›¾æ ‡
- **å¿«é€Ÿé¢„è§ˆ** - é¼ æ ‡æ‚¬åœå³å¯é¢„è§ˆæ–‡ä»¶ä¿¡æ¯
- **æ‰¹é‡æ“ä½œ** - æ”¯æŒå¤šæ–‡ä»¶ä¸Šä¼ å’Œæ‰¹é‡ç®¡ç†
- **è¿›åº¦æ˜¾ç¤º** - æ–‡ä»¶ä¸Šä¼ è¿›åº¦å®æ—¶åé¦ˆ
- **å®¹é‡æé†’** - å­˜å‚¨ç©ºé—´ä¸è¶³æ—¶æ™ºèƒ½æé†’

---

## ğŸ› ï¸ æŠ€æœ¯æ ˆä»‹ç»

### å‰ç«¯æŠ€æœ¯

- **Next.js 14** - Reactå…¨æ ˆæ¡†æ¶ï¼ŒApp Router
- **TypeScript** - ç±»å‹å®‰å…¨çš„JavaScript
- **Tailwind CSS** - å®ç”¨ä¼˜å…ˆçš„CSSæ¡†æ¶
- **Lucide React** - ç°ä»£åŒ–å›¾æ ‡åº“
- **date-fns** - æ—¥æœŸå¤„ç†å·¥å…·åº“

### åç«¯æŠ€æœ¯

- **Next.js API Routes** - æœåŠ¡ç«¯API
- **Prisma** - ç°ä»£åŒ–æ•°æ®åº“ORM
- **SQLite** - è½»é‡çº§æ•°æ®åº“
- **JWT** - JSON Web Tokenè®¤è¯
- **bcryptjs** - å¯†ç åŠ å¯†

### å¼€å‘å·¥å…·

- **Claude Code** - AIç¼–ç¨‹åŠ©æ‰‹
- **VS Code** - ä»£ç ç¼–è¾‘å™¨
- **Node.js** - JavaScriptè¿è¡Œæ—¶
- **npm** - åŒ…ç®¡ç†å™¨

---

## ğŸ”§ å¼€å‘ç¯å¢ƒå‡†å¤‡

### 1. å®‰è£…Node.js

```bash
# ä¸‹è½½å¹¶å®‰è£… Node.js 18+ ç‰ˆæœ¬
# è®¿é—® https://nodejs.org ä¸‹è½½å®‰è£…åŒ…
```

### 2. å®‰è£…Claude Code

```bash
# å®‰è£… Claude Code CLI
npm install -g @anthropic-ai/claude-code

# ç™»å½• Claude Code
claude-code login
```

### 3. åˆ›å»ºé¡¹ç›®ç›®å½•

```bash
# åˆ›å»ºé¡¹ç›®æ–‡ä»¶å¤¹
mkdir todo-manager
cd todo-manager
```

---

## ğŸš€ é¡¹ç›®åˆå§‹åŒ–

### Claude Code æç¤ºè¯ ğŸ“

```
è¯·å¸®æˆ‘åˆå§‹åŒ–ä¸€ä¸ªNext.js 14é¡¹ç›®ï¼Œè¦æ±‚ä½¿ç”¨TypeScriptå’ŒTailwind CSSã€‚é¡¹ç›®åç§°æ˜¯todo-managerï¼Œè¿™æ˜¯ä¸€ä¸ªå¾…åŠäº‹é¡¹ç®¡ç†ç³»ç»Ÿã€‚
```

### æ‰‹åŠ¨åˆå§‹åŒ–æ­¥éª¤

1. **åˆ›å»ºNext.jsé¡¹ç›®**

```bash
npx create-next-app@latest todo-manager --typescript --tailwind --eslint --app --src-dir --import-alias "@/*"
```

2. **å®‰è£…ä¾èµ–åŒ…**

```bash
# å®‰è£…é¡¹ç›®ä¾èµ–
npm install @prisma/client prisma bcryptjs jsonwebtoken date-fns react-hook-form @hookform/resolvers zod lucide-react clsx tailwind-merge

# å®‰è£…å¼€å‘ä¾èµ–
npm install -D @types/bcryptjs @types/jsonwebtoken tsx
```

3. **é…ç½®ç¯å¢ƒå˜é‡**

```bash
# åˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶
touch .env.local
```

**Claude Code æç¤ºè¯ ğŸ“**

```
è¯·å¸®æˆ‘åˆ›å»º .env.local æ–‡ä»¶ï¼ŒåŒ…å«ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š
- DATABASE_URL: SQLiteæ•°æ®åº“æ–‡ä»¶è·¯å¾„
- JWT_SECRET: JWTå¯†é’¥
- NEXTAUTH_SECRET: NextAuthå¯†é’¥
- NEXTAUTH_URL: åº”ç”¨URL
- PORT: ç«¯å£å·è®¾ç½®ä¸º3005
```

---

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

### Claude Code æç¤ºè¯ ğŸ“

```
è¯·å¸®æˆ‘è®¾è®¡ä¸€ä¸ªå¾…åŠäº‹é¡¹ç®¡ç†ç³»ç»Ÿçš„æ•°æ®åº“æ¨¡å‹ï¼Œä½¿ç”¨Prismaå’ŒSQLiteã€‚éœ€è¦åŒ…å«ä»¥ä¸‹è¡¨ï¼š
1. User - ç”¨æˆ·è¡¨ï¼ˆid, email, username, password, name, createdAt, updatedAtï¼‰
2. Category - åˆ†ç±»è¡¨ï¼ˆid, name, color, description, userId, createdAt, updatedAtï¼‰
3. Todo - å¾…åŠäº‹é¡¹è¡¨ï¼ˆid, title, description, dueDate, isCompleted, priority, quadrant, userId, categoryId, createdAt, updatedAtï¼‰
4. Attachment - é™„ä»¶è¡¨ï¼ˆid, todoId, filename, originalName, fileType, fileSize, filePath, createdAtï¼‰
5. Reminder - æé†’è¡¨ï¼ˆid, todoId, remindAt, message, isActive, createdAtï¼‰

è¯·åˆ›å»ºå®Œæ•´çš„Prisma schemaæ–‡ä»¶ï¼ŒåŒ…å«æ‰€æœ‰è¡¨å…³ç³»å’Œç´¢å¼•ã€‚
```

### ç”Ÿæˆçš„ Prisma Schema

```prisma
// prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  username  String   @unique
  password  String
  name      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  todos Todo[]
  categories Category[]

  @@map("users")
}

model Category {
  id          String   @id @default(cuid())
  name        String
  color       String?
  description String?
  userId      String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user  User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  todos Todo[]

  @@unique([userId, name])
  @@map("categories")
}

model Todo {
  id          String      @id @default(cuid())
  title       String
  description String?
  dueDate     DateTime?
  isCompleted Boolean     @default(false)
  priority    String      @default("MEDIUM")
  quadrant    String?
  userId      String
  categoryId  String?
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  user       User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  category   Category?   @relation(fields: [categoryId], references: [id], onDelete: SetNull)
  attachments Attachment[]
  reminders  Reminder[]

  @@map("todos")
}

model Attachment {
  id           String   @id @default(cuid())
  todoId       String
  filename     String
  originalName String
  fileType     String
  fileSize     Int
  filePath     String
  createdAt    DateTime @default(now())

  todo Todo @relation(fields: [todoId], references: [id], onDelete: Cascade)

  @@map("attachments")
}

model Reminder {
  id        String   @id @default(cuid())
  todoId    String
  remindAt  DateTime
  message   String?
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())

  todo Todo @relation(fields: [todoId], references: [id], onDelete: Cascade)

  @@map("reminders")
}
```

### æ•°æ®åº“åˆå§‹åŒ–

```bash
# ç”ŸæˆPrismaå®¢æˆ·ç«¯
npx prisma generate

# åˆ›å»ºæ•°æ®åº“è¡¨
npx prisma db push
```

---

## ğŸ” åç«¯APIå¼€å‘

### 1. è®¤è¯API

#### Claude Code æç¤ºè¯ ğŸ“

```
è¯·å¸®æˆ‘åˆ›å»ºç”¨æˆ·è®¤è¯ç›¸å…³çš„APIè·¯ç”±ï¼š
1. POST /api/auth/register - ç”¨æˆ·æ³¨å†Œ
2. POST /api/auth/login - ç”¨æˆ·ç™»å½•

éœ€è¦åŒ…å«ï¼š
- å¯†ç åŠ å¯†ï¼ˆbcryptjsï¼‰
- JWT tokenç”Ÿæˆ
- è¾“å…¥éªŒè¯ï¼ˆzod schemaï¼‰
- é”™è¯¯å¤„ç†
- TypeScriptç±»å‹å®šä¹‰
```

#### æ³¨å†ŒAPI (`src/app/api/auth/register/route.ts`)

```typescript
import { NextRequest, NextResponse } from 'next/server';
import { prisma } from '@/lib/prisma';
import bcryptjs from 'bcryptjs';
import jwt from 'jsonwebtoken';
import { z } from 'zod';

const registerSchema = z.object({
  email: z.string().email(),
  username: z.string().min(3).max(20),
  password: z.string().min(6),
  name: z.string().optional(),
});

export async function POST(request: NextRequest) {
  try {
    const body = await request.json();
    const { email, username, password, name } = registerSchema.parse(body);

    // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²å­˜åœ¨
    const existingUser = await prisma.user.findFirst({
      where: {
        OR: [
          { email },
          { username }
        ]
      }
    });

    if (existingUser) {
      return NextResponse.json(
        { error: 'ç”¨æˆ·å·²å­˜åœ¨' },
        { status: 400 }
      );
    }

    // åŠ å¯†å¯†ç 
    const hashedPassword = await bcryptjs.hash(password, 10);

    // åˆ›å»ºç”¨æˆ·
    const user = await prisma.user.create({
      data: {
        email,
        username,
        password: hashedPassword,
        name,
      },
      select: {
        id: true,
        email: true,
        username: true,
        name: true,
        createdAt: true,
      }
    });

    // ç”ŸæˆJWT token
    const token = jwt.sign(
      { userId: user.id, email: user.email },
      process.env.JWT_SECRET!,
      { expiresIn: '7d' }
    );

    return NextResponse.json({
      message: 'æ³¨å†ŒæˆåŠŸ',
      user,
      token,
    });
  } catch (error) {
    console.error('æ³¨å†Œé”™è¯¯:', error);
    return NextResponse.json(
      { error: 'æ³¨å†Œå¤±è´¥' },
      { status: 500 }
    );
  }
}
```

#### ç™»å½•API (`src/app/api/auth/login/route.ts`)

```typescript
import { NextRequest, NextResponse } from 'next/server';
import { prisma } from '@/lib/prisma';
import bcryptjs from 'bcryptjs';
import jwt from 'jsonwebtoken';
import { z } from 'zod';

const loginSchema = z.object({
  email: z.string().email(),
  password: z.string().min(1),
});

export async function POST(request: NextRequest) {
  try {
    const body = await request.json();
    const { email, password } = loginSchema.parse(body);

    // æŸ¥æ‰¾ç”¨æˆ·
    const user = await prisma.user.findUnique({
      where: { email },
    });

    if (!user) {
      return NextResponse.json(
        { error: 'ç”¨æˆ·ä¸å­˜åœ¨' },
        { status: 401 }
      );
    }

    // éªŒè¯å¯†ç 
    const isPasswordValid = await bcryptjs.compare(password, user.password);
    if (!isPasswordValid) {
      return NextResponse.json(
        { error: 'å¯†ç é”™è¯¯' },
        { status: 401 }
      );
    }

    // ç”ŸæˆJWT token
    const token = jwt.sign(
      { userId: user.id, email: user.email },
      process.env.JWT_SECRET!,
      { expiresIn: '7d' }
    );

    return NextResponse.json({
      message: 'ç™»å½•æˆåŠŸ',
      user: {
        id: user.id,
        email: user.email,
        username: user.username,
        name: user.name,
      },
      token,
    });
  } catch (error) {
    console.error('ç™»å½•é”™è¯¯:', error);
    return NextResponse.json(
      { error: 'ç™»å½•å¤±è´¥' },
      { status: 500 }
    );
  }
}
```

### 2. å¾…åŠäº‹é¡¹API

#### Claude Code æç¤ºè¯ ğŸ“

```
è¯·å¸®æˆ‘åˆ›å»ºå¾…åŠäº‹é¡¹ç®¡ç†çš„APIè·¯ç”±ï¼š
1. GET /api/todos - è·å–å¾…åŠäº‹é¡¹åˆ—è¡¨
2. POST /api/todos - åˆ›å»ºæ–°å¾…åŠäº‹é¡¹
3. PUT /api/todos/[id] - æ›´æ–°å¾…åŠäº‹é¡¹
4. DELETE /api/todos/[id] - åˆ é™¤å¾…åŠäº‹é¡¹

éœ€è¦åŒ…å«ï¼š
- JWTè®¤è¯ä¸­é—´ä»¶
- å®Œæ•´çš„CRUDæ“ä½œ
- å…³è”æŸ¥è¯¢ï¼ˆåˆ†ç±»ã€é™„ä»¶ï¼‰
- åˆ†é¡µå’Œç­›é€‰
- é”™è¯¯å¤„ç†
```

#### å¾…åŠäº‹é¡¹API (`src/app/api/todos/route.ts`)

```typescript
import { NextRequest, NextResponse } from 'next/server';
import { prisma } from '@/lib/prisma';
import jwt from 'jsonwebtoken';
import { z } from 'zod';

const todoSchema = z.object({
  title: z.string().min(1).max(200),
  description: z.string().optional(),
  dueDate: z.string().optional(),
  priority: z.enum(['HIGH', 'MEDIUM', 'LOW']).default('MEDIUM'),
  quadrant: z.enum(['Q1', 'Q2', 'Q3', 'Q4']).optional(),
  categoryId: z.string().optional(),
});

// JWTè®¤è¯ä¸­é—´ä»¶
async function authenticateUser(request: NextRequest) {
  const authHeader = request.headers.get('authorization');
  if (!authHeader || !authHeader.startsWith('Bearer ')) {
    throw new Error('æœªæä¾›è®¤è¯ä»¤ç‰Œ');
  }

  const token = authHeader.substring(7);
  try {
    const decoded = jwt.verify(token, process.env.JWT_SECRET!) as any;
    return decoded;
  } catch (error) {
    throw new Error('æ— æ•ˆçš„è®¤è¯ä»¤ç‰Œ');
  }
}

// è·å–å¾…åŠäº‹é¡¹åˆ—è¡¨
export async function GET(request: NextRequest) {
  try {
    const decoded = await authenticateUser(request);
    const { searchParams } = new URL(request.url);

    const page = parseInt(searchParams.get('page') || '1');
    const limit = parseInt(searchParams.get('limit') || '10');
    const status = searchParams.get('status');
    const priority = searchParams.get('priority');
    const categoryId = searchParams.get('categoryId');

    const where: any = { userId: decoded.userId };

    if (status === 'completed') {
      where.isCompleted = true;
    } else if (status === 'pending') {
      where.isCompleted = false;
    }

    if (priority) {
      where.priority = priority;
    }

    if (categoryId) {
      where.categoryId = categoryId;
    }

    const [todos, total] = await Promise.all([
      prisma.todo.findMany({
        where,
        include: {
          category: true,
          attachments: true,
          reminders: true,
        },
        orderBy: [
          { isCompleted: 'asc' },
          { priority: 'desc' },
          { dueDate: 'asc' },
          { createdAt: 'desc' }
        ],
        skip: (page - 1) * limit,
        take: limit,
      }),
      prisma.todo.count({ where })
    ]);

    return NextResponse.json({
      todos,
      pagination: {
        page,
        limit,
        total,
        pages: Math.ceil(total / limit),
      },
    });
  } catch (error) {
    console.error('è·å–å¾…åŠäº‹é¡¹é”™è¯¯:', error);
    return NextResponse.json(
      { error: error instanceof Error ? error.message : 'è·å–å¤±è´¥' },
      { status: 401 }
    );
  }
}

// åˆ›å»ºæ–°å¾…åŠäº‹é¡¹
export async function POST(request: NextRequest) {
  try {
    const decoded = await authenticateUser(request);
    const body = await request.json();
    const { title, description, dueDate, priority, quadrant, categoryId } = todoSchema.parse(body);

    const todo = await prisma.todo.create({
      data: {
        title,
        description,
        dueDate: dueDate ? new Date(dueDate) : null,
        priority,
        quadrant,
        categoryId,
        userId: decoded.userId,
      },
      include: {
        category: true,
        attachments: true,
        reminders: true,
      },
    });

    return NextResponse.json({
      message: 'åˆ›å»ºæˆåŠŸ',
      todo,
    });
  } catch (error) {
    console.error('åˆ›å»ºå¾…åŠäº‹é¡¹é”™è¯¯:', error);
    return NextResponse.json(
      { error: error instanceof Error ? error.message : 'åˆ›å»ºå¤±è´¥' },
      { status: error instanceof Error ? 401 : 500 }
    );
  }
}
```

### 3. åˆ†ç±»ç®¡ç†API

#### Claude Code æç¤ºè¯ ğŸ“

```
è¯·å¸®æˆ‘åˆ›å»ºåˆ†ç±»ç®¡ç†çš„APIè·¯ç”±ï¼š
1. GET /api/categories - è·å–åˆ†ç±»åˆ—è¡¨
2. POST /api/categories - åˆ›å»ºæ–°åˆ†ç±»
3. PUT /api/categories/[id] - æ›´æ–°åˆ†ç±»
4. DELETE /api/categories/[id] - åˆ é™¤åˆ†ç±»

éœ€è¦åŒ…å«ç”¨æˆ·æ•°æ®éš”ç¦»å’Œé¢œè‰²ç®¡ç†åŠŸèƒ½ã€‚
```

### 4. é™„ä»¶ç®¡ç†API

#### Claude Code æç¤ºè¯ ğŸ“

```
è¯·å¸®æˆ‘åˆ›å»ºé™„ä»¶ç®¡ç†çš„APIè·¯ç”±ï¼š
1. POST /api/attachments - ä¸Šä¼ é™„ä»¶
2. GET /api/attachments/[id] - ä¸‹è½½é™„ä»¶
3. DELETE /api/attachments/[id] - åˆ é™¤é™„ä»¶

éœ€è¦æ”¯æŒï¼š
- æ–‡ä»¶ç±»å‹éªŒè¯ï¼ˆWord, Excel, PPT, PDF, TXTï¼‰
- æ–‡ä»¶å¤§å°é™åˆ¶ï¼ˆ10MBï¼‰
- å®‰å…¨çš„æ–‡ä»¶å­˜å‚¨å’Œè®¿é—®
- æ–‡ä»¶åˆ é™¤æ¸…ç†
```

---

## ğŸ¨ å‰ç«¯é¡µé¢å¼€å‘

### 1. è®¤è¯é¡µé¢

#### Claude Code æç¤ºè¯ ğŸ“

```
è¯·å¸®æˆ‘åˆ›å»ºç”¨æˆ·è®¤è¯é¡µé¢ï¼š
1. ç™»å½•é¡µé¢ - /auth/login
2. æ³¨å†Œé¡µé¢ - /auth/register

éœ€è¦åŒ…å«ï¼š
- ç¾è§‚çš„è¡¨å•è®¾è®¡
- è¡¨å•éªŒè¯
- é”™è¯¯æç¤º
- å“åº”å¼è®¾è®¡
- è·³è½¬é€»è¾‘
```

#### ç™»å½•é¡µé¢ (`src/app/auth/login/page.tsx`)

```typescript
'use client';

import { useState } from 'react';
import { useRouter } from 'next/navigation';
import Link from 'next/link';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';

export default function LoginPage() {
  const [formData, setFormData] = useState({
    email: '',
    password: '',
  });
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState('');
  const router = useRouter();

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setLoading(true);
    setError('');

    try {
      const response = await fetch('/api/auth/login', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(formData),
      });

      const data = await response.json();

      if (response.ok) {
        localStorage.setItem('token', data.token);
        localStorage.setItem('user', JSON.stringify(data.user));
        router.push('/dashboard');
      } else {
        setError(data.error || 'ç™»å½•å¤±è´¥');
      }
    } catch (error) {
      setError('ç½‘ç»œé”™è¯¯ï¼Œè¯·é‡è¯•');
    } finally {
      setLoading(false);
    }
  };

  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    setFormData({
      ...formData,
      [e.target.name]: e.target.value,
    });
  };

  return (
    <div className="min-h-screen flex items-center justify-center bg-gray-50">
      <Card className="w-full max-w-md">
        <CardHeader>
          <CardTitle className="text-2xl font-bold text-center">ç™»å½•</CardTitle>
          <CardDescription className="text-center">
            æ¬¢è¿å›åˆ°å¾…åŠäº‹é¡¹ç®¡ç†ç³»ç»Ÿ
          </CardDescription>
        </CardHeader>
        <CardContent>
          <form onSubmit={handleSubmit} className="space-y-4">
            <div>
              <label htmlFor="email" className="block text-sm font-medium mb-2">
                é‚®ç®±
              </label>
              <Input
                id="email"
                name="email"
                type="email"
                value={formData.email}
                onChange={handleChange}
                required
                placeholder="è¯·è¾“å…¥é‚®ç®±"
              />
            </div>
            <div>
              <label htmlFor="password" className="block text-sm font-medium mb-2">
                å¯†ç 
              </label>
              <Input
                id="password"
                name="password"
                type="password"
                value={formData.password}
                onChange={handleChange}
                required
                placeholder="è¯·è¾“å…¥å¯†ç "
              />
            </div>
            {error && (
              <div className="text-red-500 text-sm text-center">{error}</div>
            )}
            <Button type="submit" className="w-full" disabled={loading}>
              {loading ? 'ç™»å½•ä¸­...' : 'ç™»å½•'}
            </Button>
          </form>
          <div className="mt-4 text-center">
            <span className="text-sm text-gray-600">
              è¿˜æ²¡æœ‰è´¦å·ï¼Ÿ{' '}
              <Link href="/auth/register" className="text-blue-600 hover:underline">
                ç«‹å³æ³¨å†Œ
              </Link>
            </span>
          </div>
        </CardContent>
      </Card>
    </div>
  );
}
```

### 2. ä»ªè¡¨æ¿é¡µé¢

#### Claude Code æç¤ºè¯ ğŸ“

```
è¯·å¸®æˆ‘åˆ›å»ºä»ªè¡¨æ¿é¡µé¢ï¼ŒåŒ…å«ï¼š
1. ä»»åŠ¡ç»Ÿè®¡æ¦‚è§ˆ
2. å¿«é€Ÿæ·»åŠ ä»»åŠ¡åŠŸèƒ½
3. æœ€è¿‘ä»»åŠ¡åˆ—è¡¨
4. å››è±¡é™ä»»åŠ¡åˆ†å¸ƒ
5. ä¼˜å…ˆçº§ä»»åŠ¡åˆ†å¸ƒ
6. ç¾è§‚çš„å¡ç‰‡å¸ƒå±€
```

#### ä»ªè¡¨æ¿é¡µé¢ (`src/app/dashboard/page.tsx`)

```typescript
'use client';

import { useState, useEffect } from 'react';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Plus, Calendar, CheckCircle, Clock, AlertCircle } from 'lucide-react';

interface DashboardStats {
  total: number;
  completed: number;
  pending: number;
  overdue: number;
}

interface Todo {
  id: string;
  title: string;
  description?: string;
  dueDate?: string;
  isCompleted: boolean;
  priority: string;
  quadrant?: string;
  category?: {
    id: string;
    name: string;
    color?: string;
  };
}

export default function DashboardPage() {
  const [stats, setStats] = useState<DashboardStats>({
    total: 0,
    completed: 0,
    pending: 0,
    overdue: 0,
  });
  const [recentTodos, setRecentTodos] = useState<Todo[]>([]);
  const [quickAddTitle, setQuickAddTitle] = useState('');
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetchDashboardData();
  }, []);

  const fetchDashboardData = async () => {
    try {
      const token = localStorage.getItem('token');
      if (!token) return;

      // è·å–ç»Ÿè®¡æ•°æ®
      const statsResponse = await fetch('/api/todos/stats', {
        headers: {
          'Authorization': `Bearer ${token}`,
        },
      });

      // è·å–æœ€è¿‘ä»»åŠ¡
      const todosResponse = await fetch('/api/todos?limit=5', {
        headers: {
          'Authorization': `Bearer ${token}`,
        },
      });

      if (statsResponse.ok) {
        const statsData = await statsResponse.json();
        setStats(statsData);
      }

      if (todosResponse.ok) {
        const todosData = await todosResponse.json();
        setRecentTodos(todosData.todos);
      }
    } catch (error) {
      console.error('è·å–ä»ªè¡¨æ¿æ•°æ®é”™è¯¯:', error);
    } finally {
      setLoading(false);
    }
  };

  const handleQuickAdd = async (e: React.FormEvent) => {
    e.preventDefault();
    if (!quickAddTitle.trim()) return;

    try {
      const token = localStorage.getItem('token');
      const response = await fetch('/api/todos', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${token}`,
        },
        body: JSON.stringify({
          title: quickAddTitle,
          priority: 'MEDIUM',
        }),
      });

      if (response.ok) {
        setQuickAddTitle('');
        fetchDashboardData();
      }
    } catch (error) {
      console.error('å¿«é€Ÿæ·»åŠ ä»»åŠ¡é”™è¯¯:', error);
    }
  };

  const getPriorityColor = (priority: string) => {
    switch (priority) {
      case 'HIGH': return 'text-red-600 bg-red-50';
      case 'MEDIUM': return 'text-yellow-600 bg-yellow-50';
      case 'LOW': return 'text-green-600 bg-green-50';
      default: return 'text-gray-600 bg-gray-50';
    }
  };

  const getQuadrantName = (quadrant: string) => {
    switch (quadrant) {
      case 'Q1': return 'ç´§æ€¥ä¸”é‡è¦';
      case 'Q2': return 'ä¸ç´§æ€¥ä½†é‡è¦';
      case 'Q3': return 'ç´§æ€¥ä½†ä¸é‡è¦';
      case 'Q4': return 'ä¸ç´§æ€¥ä¸”ä¸é‡è¦';
      default: return '';
    }
  };

  if (loading) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"></div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gray-50 p-6">
      <div className="max-w-7xl mx-auto">
        <div className="mb-8">
          <h1 className="text-3xl font-bold text-gray-900">ä»ªè¡¨æ¿</h1>
          <p className="text-gray-600 mt-2">æ¬¢è¿å›æ¥ï¼è¿™é‡Œæ˜¯æ‚¨çš„ä»»åŠ¡æ¦‚è§ˆ</p>
        </div>

        {/* ç»Ÿè®¡å¡ç‰‡ */}
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
          <Card>
            <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
              <CardTitle className="text-sm font-medium">æ€»ä»»åŠ¡æ•°</CardTitle>
              <Calendar className="h-4 w-4 text-muted-foreground" />
            </CardHeader>
            <CardContent>
              <div className="text-2xl font-bold">{stats.total}</div>
              <p className="text-xs text-muted-foreground">
                æ‰€æœ‰ä»»åŠ¡
              </p>
            </CardContent>
          </Card>

          <Card>
            <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
              <CardTitle className="text-sm font-medium">å·²å®Œæˆ</CardTitle>
              <CheckCircle className="h-4 w-4 text-green-600" />
            </CardHeader>
            <CardContent>
              <div className="text-2xl font-bold text-green-600">{stats.completed}</div>
              <p className="text-xs text-muted-foreground">
                å®Œæˆç‡ {stats.total > 0 ? Math.round((stats.completed / stats.total) * 100) : 0}%
              </p>
            </CardContent>
          </Card>

          <Card>
            <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
              <CardTitle className="text-sm font-medium">è¿›è¡Œä¸­</CardTitle>
              <Clock className="h-4 w-4 text-blue-600" />
            </CardHeader>
            <CardContent>
              <div className="text-2xl font-bold text-blue-600">{stats.pending}</div>
              <p className="text-xs text-muted-foreground">
                å¾…å®Œæˆä»»åŠ¡
              </p>
            </CardContent>
          </Card>

          <Card>
            <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
              <CardTitle className="text-sm font-medium">å·²é€¾æœŸ</CardTitle>
              <AlertCircle className="h-4 w-4 text-red-600" />
            </CardHeader>
            <CardContent>
              <div className="text-2xl font-bold text-red-600">{stats.overdue}</div>
              <p className="text-xs text-muted-foreground">
                éœ€è¦ç«‹å³å¤„ç†
              </p>
            </CardContent>
          </Card>
        </div>

        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
          {/* å¿«é€Ÿæ·»åŠ ä»»åŠ¡ */}
          <Card>
            <CardHeader>
              <CardTitle className="flex items-center gap-2">
                <Plus className="h-5 w-5" />
                å¿«é€Ÿæ·»åŠ ä»»åŠ¡
              </CardTitle>
              <CardDescription>
                å¿«é€Ÿåˆ›å»ºä¸€ä¸ªæ–°çš„å¾…åŠäº‹é¡¹
              </CardDescription>
            </CardHeader>
            <CardContent>
              <form onSubmit={handleQuickAdd} className="flex gap-2">
                <Input
                  placeholder="è¾“å…¥ä»»åŠ¡æ ‡é¢˜..."
                  value={quickAddTitle}
                  onChange={(e) => setQuickAddTitle(e.target.value)}
                  className="flex-1"
                />
                <Button type="submit" disabled={!quickAddTitle.trim()}>
                  æ·»åŠ 
                </Button>
              </form>
            </CardContent>
          </Card>

          {/* æœ€è¿‘ä»»åŠ¡ */}
          <Card>
            <CardHeader>
              <CardTitle>æœ€è¿‘ä»»åŠ¡</CardTitle>
              <CardDescription>
                æœ€æ–°åˆ›å»ºçš„ä»»åŠ¡
              </CardDescription>
            </CardHeader>
            <CardContent>
              <div className="space-y-3">
                {recentTodos.length === 0 ? (
                  <p className="text-gray-500 text-center py-4">æš‚æ— ä»»åŠ¡</p>
                ) : (
                  recentTodos.map((todo) => (
                    <div key={todo.id} className="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                      <div className="flex-1">
                        <h4 className={`font-medium ${todo.isCompleted ? 'line-through text-gray-500' : ''}`}>
                          {todo.title}
                        </h4>
                        <div className="flex items-center gap-2 mt-1">
                          <span className={`text-xs px-2 py-1 rounded-full ${getPriorityColor(todo.priority)}`}>
                            {todo.priority === 'HIGH' ? 'é«˜' : todo.priority === 'MEDIUM' ? 'ä¸­' : 'ä½'}ä¼˜å…ˆçº§
                          </span>
                          {todo.quadrant && (
                            <span className="text-xs text-gray-500">
                              {getQuadrantName(todo.quadrant)}
                            </span>
                          )}
                        </div>
                      </div>
                      <div className={`w-3 h-3 rounded-full ${todo.isCompleted ? 'bg-green-500' : 'bg-gray-300'}`}></div>
                    </div>
                  ))
                )}
              </div>
            </CardContent>
          </Card>
        </div>
      </div>
    </div>
  );
}
```

---

## â˜ï¸ äº‘ç›˜å­˜å‚¨åŠŸèƒ½

### ğŸ¯ åˆ›æ–°è®¾è®¡ç†å¿µ

ä¼ ç»Ÿçš„äº‘ç›˜åªæ˜¯æ–‡ä»¶å­˜å‚¨ï¼Œè€Œæˆ‘ä»¬çš„äº‘ç›˜ä¸ä»»åŠ¡ç®¡ç†æ·±åº¦ç»“åˆï¼š

- **ä»»åŠ¡é©±åŠ¨å­˜å‚¨** - æ¯ä¸ªæ–‡ä»¶éƒ½ä¸å…·ä½“ä»»åŠ¡å…³è”ï¼Œè®©æ–‡ä»¶æ›´æœ‰æ„ä¹‰
- **ä¸Šä¸‹æ–‡ç®¡ç†** - é€šè¿‡ä»»åŠ¡å¿«é€Ÿå®šä½ç›¸å…³æ–‡ä»¶ï¼Œæé«˜æ£€ç´¢æ•ˆç‡
- **å·¥ä½œæµé›†æˆ** - æ–‡ä»¶ä¸ä»»åŠ¡è¿›åº¦åŒæ­¥ï¼Œå½¢æˆå®Œæ•´çš„å·¥ä½œé—­ç¯
- **çŸ¥è¯†æ²‰æ·€** - å®Œæˆçš„ä»»åŠ¡å’Œæ–‡ä»¶å½¢æˆä¸ªäººçŸ¥è¯†åº“

### 1. äº‘ç›˜å­˜å‚¨APIè®¾è®¡

#### Claude Code æç¤ºè¯ ğŸ“

```
è¯·å¸®æˆ‘åˆ›å»ºäº‘ç›˜å­˜å‚¨ç›¸å…³çš„APIè·¯ç”±ï¼š
1. POST /api/attachments - ä¸Šä¼ é™„ä»¶åˆ°æŒ‡å®šä»»åŠ¡
2. GET /api/attachments - è·å–ä»»åŠ¡çš„é™„ä»¶åˆ—è¡¨
3. GET /api/attachments/[id] - ä¸‹è½½æŒ‡å®šé™„ä»¶
4. DELETE /api/attachments/[id] - åˆ é™¤é™„ä»¶
5. GET /api/files/storage - è·å–ç”¨æˆ·å­˜å‚¨ç»Ÿè®¡
6. POST /api/files/upload-batch - æ‰¹é‡æ–‡ä»¶ä¸Šä¼ 

éœ€è¦åŒ…å«ï¼š
- æ–‡ä»¶ç±»å‹éªŒè¯ï¼ˆWord, Excel, PPT, PDF, TXTï¼‰
- æ–‡ä»¶å¤§å°é™åˆ¶ï¼ˆ10MBï¼‰
- ç”¨æˆ·å­˜å‚¨ç©ºé—´é™åˆ¶ï¼ˆæ¯äºº100MBï¼‰
- æ–‡ä»¶å®‰å…¨æ‰«æå’Œç—…æ¯’æ£€æµ‹
- æ–‡ä»¶é‡åå¤„ç†ï¼ˆè‡ªåŠ¨é‡å‘½åï¼‰
- ä¸Šä¼ è¿›åº¦è¿½è¸ª
- æ–‡ä»¶é¢„è§ˆURLç”Ÿæˆ
```

#### é™„ä»¶ç®¡ç†API (`src/app/api/attachments/route.ts`)

```typescript
import { NextRequest, NextResponse } from 'next/server'
import { prisma } from '@/lib/prisma'
import { verifyToken } from '@/lib/auth'
import { writeFile, mkdir } from 'fs/promises'
import { join } from 'path'
import { existsSync } from 'fs'

// å…è®¸çš„æ–‡ä»¶ç±»å‹
const ALLOWED_FILE_TYPES = {
  'application/msword': ['.doc'],
  'application/vnd.openxmlformats-officedocument.wordprocessingml.document': ['.docx'],
  'application/vnd.ms-excel': ['.xls'],
  'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet': ['.xlsx'],
  'application/vnd.ms-powerpoint': ['.ppt'],
  'application/vnd.openxmlformats-officedocument.presentationml.presentation': ['.pptx'],
  'text/plain': ['.txt'],
  'application/pdf': ['.pdf']
}

// å…è®¸çš„æ–‡ä»¶æ‰©å±•å
const ALLOWED_EXTENSIONS = ['.doc', '.docx', '.xls', '.xlsx', '.ppt', '.pptx', '.txt', '.pdf']

// æœ€å¤§æ–‡ä»¶å¤§å° (10MB)
const MAX_FILE_SIZE = 10 * 1024 * 1024

// ç”¨æˆ·å­˜å‚¨ç©ºé—´é™åˆ¶ (100MB)
const USER_STORAGE_LIMIT = 100 * 1024 * 1024

// POST - ä¸Šä¼ é™„ä»¶
export async function POST(request: NextRequest) {
  try {
    const token = request.headers.get('authorization')?.replace('Bearer ', '')

    if (!token) {
      return NextResponse.json({ error: 'æœªæä¾›è®¤è¯ä»¤ç‰Œ' }, { status: 401 })
    }

    const decoded = verifyToken(token)
    if (!decoded) {
      return NextResponse.json({ error: 'æ— æ•ˆçš„è®¤è¯ä»¤ç‰Œ' }, { status: 401 })
    }

    const formData = await request.formData()
    const file = formData.get('file') as File
    const todoId = formData.get('todoId') as string

    if (!file) {
      return NextResponse.json({ error: 'æœªæä¾›æ–‡ä»¶' }, { status: 400 })
    }

    if (!todoId) {
      return NextResponse.json({ error: 'æœªæä¾›å¾…åŠäº‹é¡¹ID' }, { status: 400 })
    }

    // æ£€æŸ¥ç”¨æˆ·å­˜å‚¨ç©ºé—´
    const currentStorage = await prisma.attachment.aggregate({
      where: {
        todo: {
          userId: decoded.userId
        }
      },
      _sum: {
        fileSize: true
      }
    })

    const totalStorage = (currentStorage._sum.fileSize || 0) + file.size
    if (totalStorage > USER_STORAGE_LIMIT) {
      return NextResponse.json({
        error: `å­˜å‚¨ç©ºé—´ä¸è¶³ã€‚å½“å‰ä½¿ç”¨ï¼š${formatBytes(currentStorage._sum.fileSize || 0)}ï¼Œé™åˆ¶ï¼š${formatBytes(USER_STORAGE_LIMIT)}`
      }, { status: 400 })
    }

    // éªŒè¯æ–‡ä»¶å¤§å°
    if (file.size > MAX_FILE_SIZE) {
      return NextResponse.json({ error: 'æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡10MB' }, { status: 400 })
    }

    // éªŒè¯æ–‡ä»¶ç±»å‹
    const fileExtension = '.' + file.name.split('.').pop()?.toLowerCase()

    if (!ALLOWED_EXTENSIONS.includes(fileExtension)) {
      return NextResponse.json({
        error: `ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹ã€‚æ”¯æŒçš„æ ¼å¼ï¼š${ALLOWED_EXTENSIONS.join(', ')}`
      }, { status: 400 })
    }

    // éªŒè¯MIMEç±»å‹
    if (!Object.keys(ALLOWED_FILE_TYPES).includes(file.type)) {
      return NextResponse.json({ error: 'æ–‡ä»¶MIMEç±»å‹ä¸æ”¯æŒ' }, { status: 400 })
    }

    // éªŒè¯å¾…åŠäº‹é¡¹æ˜¯å¦å­˜åœ¨ä¸”å±äºå½“å‰ç”¨æˆ·
    const todo = await prisma.todo.findFirst({
      where: {
        id: todoId,
        userId: decoded.userId,
      },
    })

    if (!todo) {
      return NextResponse.json({ error: 'å¾…åŠäº‹é¡¹ä¸å­˜åœ¨' }, { status: 404 })
    }

    // åˆ›å»ºç”¨æˆ·ä¸“å±ä¸Šä¼ ç›®å½•
    const uploadDir = join(process.cwd(), 'uploads', decoded.userId, 'attachments')
    if (!existsSync(uploadDir)) {
      await mkdir(uploadDir, { recursive: true })
    }

    // ç”Ÿæˆå”¯ä¸€æ–‡ä»¶åï¼ˆé¿å…é‡åï¼‰
    const timestamp = Date.now()
    const randomString = Math.random().toString(36).substring(2, 8)
    const uniqueFilename = `${timestamp}_${randomString}_${file.name}`
    const filePath = join(uploadDir, uniqueFilename)

    // ä¿å­˜æ–‡ä»¶
    const bytes = await file.arrayBuffer()
    const buffer = Buffer.from(bytes)
    await writeFile(filePath, buffer)

    // ä¿å­˜é™„ä»¶ä¿¡æ¯åˆ°æ•°æ®åº“
    const attachment = await prisma.attachment.create({
      data: {
        todoId,
        filename: uniqueFilename,
        originalName: file.name,
        fileType: file.type,
        fileSize: file.size,
        filePath: `/uploads/${decoded.userId}/attachments/${uniqueFilename}`,
      },
    })

    return NextResponse.json({
      message: 'æ–‡ä»¶ä¸Šä¼ æˆåŠŸ',
      attachment: {
        id: attachment.id,
        originalName: attachment.originalName,
        fileType: attachment.fileType,
        fileSize: attachment.fileSize,
        createdAt: attachment.createdAt,
      },
      storageInfo: {
        used: totalStorage,
        limit: USER_STORAGE_LIMIT,
        remaining: USER_STORAGE_LIMIT - totalStorage,
      }
    })

  } catch (error) {
    console.error('æ–‡ä»¶ä¸Šä¼ å¤±è´¥:', error)
    return NextResponse.json(
      { error: 'æœåŠ¡å™¨å†…éƒ¨é”™è¯¯' },
      { status: 500 }
    )
  }
}

// æ ¼å¼åŒ–å­—èŠ‚æ•°
function formatBytes(bytes: number): string {
  if (bytes === 0) return '0 B'
  const k = 1024
  const sizes = ['B', 'KB', 'MB', 'GB']
  const i = Math.floor(Math.log(bytes) / Math.log(k))
  return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i]
}
```

### 2. äº‘ç›˜å­˜å‚¨ç»Ÿè®¡API

#### Claude Code æç¤ºè¯ ğŸ“

```
è¯·å¸®æˆ‘åˆ›å»ºç”¨æˆ·å­˜å‚¨ç»Ÿè®¡APIï¼š
1. è·å–ç”¨æˆ·å½“å‰å­˜å‚¨ä½¿ç”¨æƒ…å†µ
2. æŒ‰æ–‡ä»¶ç±»å‹ç»Ÿè®¡å­˜å‚¨åˆ†å¸ƒ
3. å­˜å‚¨ä½¿ç”¨è¶‹åŠ¿åˆ†æ
4. å­˜å‚¨ç©ºé—´æé†’åŠŸèƒ½
5. æ–‡ä»¶ä¸Šä¼ å†å²è®°å½•

è¯·åˆ›å»º /api/files/storage è·¯ç”±ã€‚
```

#### å­˜å‚¨ç»Ÿè®¡API (`src/app/api/files/storage/route.ts`)

```typescript
import { NextRequest, NextResponse } from 'next/server'
import { prisma } from '@/lib/prisma'
import { verifyToken } from '@/lib/auth'

// ç”¨æˆ·å­˜å‚¨ç©ºé—´é™åˆ¶ (100MB)
const USER_STORAGE_LIMIT = 100 * 1024 * 1024

export async function GET(request: NextRequest) {
  try {
    const token = request.headers.get('authorization')?.replace('Bearer ', '')

    if (!token) {
      return NextResponse.json({ error: 'æœªæä¾›è®¤è¯ä»¤ç‰Œ' }, { status: 401 })
    }

    const decoded = verifyToken(token)
    if (!decoded) {
      return NextResponse.json({ error: 'æ— æ•ˆçš„è®¤è¯ä»¤ç‰Œ' }, { status: 401 })
    }

    // è·å–ç”¨æˆ·æ€»å­˜å‚¨ä½¿ç”¨é‡
    const totalStorage = await prisma.attachment.aggregate({
      where: {
        todo: {
          userId: decoded.userId
        }
      },
      _sum: {
        fileSize: true
      },
      _count: {
        id: true
      }
    })

    // æŒ‰æ–‡ä»¶ç±»å‹ç»Ÿè®¡
    const storageByType = await prisma.attachment.groupBy({
      by: ['fileType'],
      where: {
        todo: {
          userId: decoded.userId
        }
      },
      _sum: {
        fileSize: true
      },
      _count: {
        id: true
      }
    })

    // æŒ‰æœˆä»½ç»Ÿè®¡ä¸Šä¼ è¶‹åŠ¿
    const uploadTrend = await prisma.$queryRaw`
      SELECT
        strftime('%Y-%m', createdAt) as month,
        COUNT(*) as count,
        SUM(fileSize) as size
      FROM attachments
      WHERE todoId IN (
        SELECT id FROM todos WHERE userId = ${decoded.userId}
      )
      GROUP BY strftime('%Y-%m', createdAt)
      ORDER BY month DESC
      LIMIT 12
    ` as Array<{ month: string; count: number; size: number }>

    // æœ€è¿‘ä¸Šä¼ çš„æ–‡ä»¶
    const recentFiles = await prisma.attachment.findMany({
      where: {
        todo: {
          userId: decoded.userId
        }
      },
      include: {
        todo: {
          select: {
            id: true,
            title: true
          }
        }
      },
      orderBy: {
        createdAt: 'desc'
      },
      take: 10,
      select: {
        id: true,
        originalName: true,
        fileType: true,
        fileSize: true,
        createdAt: true,
        todo: {
          select: {
            id: true,
            title: true
          }
        }
      }
    })

    const usedStorage = totalStorage._sum.fileSize || 0
    const fileCount = totalStorage._count.id || 0

    return NextResponse.json({
      storage: {
        used: usedStorage,
        limit: USER_STORAGE_LIMIT,
        remaining: Math.max(0, USER_STORAGE_LIMIT - usedStorage),
        usagePercentage: Math.round((usedStorage / USER_STORAGE_LIMIT) * 100),
        fileCount
      },
      storageByType: storageByType.map(item => ({
        type: item.fileType,
        size: item._sum.fileSize || 0,
        count: item._count.id || 0,
        typeName: getFileTypeName(item.fileType)
      })),
      uploadTrend: uploadTrend.map(item => ({
        month: item.month,
        count: item.count,
        size: item.size || 0
      })),
      recentFiles: recentFiles.map(file => ({
        id: file.id,
        name: file.originalName,
        type: file.fileType,
        size: file.fileSize,
        uploadedAt: file.createdAt,
        todo: {
          id: file.todo.id,
          title: file.todo.title
        }
      }))
    })

  } catch (error) {
    console.error('è·å–å­˜å‚¨ç»Ÿè®¡å¤±è´¥:', error)
    return NextResponse.json(
      { error: 'æœåŠ¡å™¨å†…éƒ¨é”™è¯¯' },
      { status: 500 }
    )
  }
}

// è·å–æ–‡ä»¶ç±»å‹æ˜¾ç¤ºåç§°
function getFileTypeName(fileType: string): string {
  const typeMap: Record<string, string> = {
    'application/msword': 'Wordæ–‡æ¡£',
    'application/vnd.openxmlformats-officedocument.wordprocessingml.document': 'Wordæ–‡æ¡£',
    'application/vnd.ms-excel': 'Excelè¡¨æ ¼',
    'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet': 'Excelè¡¨æ ¼',
    'application/vnd.ms-powerpoint': 'PowerPointæ¼”ç¤ºæ–‡ç¨¿',
    'application/vnd.openxmlformats-officedocument.presentationml.presentation': 'PowerPointæ¼”ç¤ºæ–‡ç¨¿',
    'text/plain': 'æ–‡æœ¬æ–‡ä»¶',
    'application/pdf': 'PDFæ–‡æ¡£'
  }
  return typeMap[fileType] || 'å…¶ä»–æ–‡ä»¶'
}
```

### 3. é™„ä»¶ç®¡ç†ç»„ä»¶

#### Claude Code æç¤ºè¯ ğŸ“

```
è¯·å¸®æˆ‘åˆ›å»ºé«˜çº§é™„ä»¶ç®¡ç†ç»„ä»¶ï¼š
1. æ‹–æ‹½ä¸Šä¼ åŠŸèƒ½
2. æ‰¹é‡æ–‡ä»¶ä¸Šä¼ 
3. ä¸Šä¼ è¿›åº¦æ˜¾ç¤º
4. æ–‡ä»¶ç±»å‹å›¾æ ‡
5. æ–‡ä»¶é¢„è§ˆåŠŸèƒ½
6. å­˜å‚¨ç©ºé—´æ˜¾ç¤º
7. æ–‡ä»¶æœç´¢å’Œç­›é€‰
8. æ‰¹é‡æ“ä½œï¼ˆåˆ é™¤ã€ä¸‹è½½ï¼‰

è¯·åˆ›å»º AttachmentManager ç»„ä»¶ã€‚
```

#### é™„ä»¶ç®¡ç†ç»„ä»¶ (`src/components/attachments.tsx`)

```typescript
'use client'

import { useState, useRef, useCallback } from 'react'
import { useAuth } from '@/lib/auth-context'
import { Button } from '@/components/ui/button'
import { Card, CardContent } from '@/components/ui/card'
import { Progress } from '@/components/ui/progress'
import { Badge } from '@/components/ui/badge'
import {
  Paperclip,
  Upload,
  Download,
  Trash2,
  FileText,
  FileSpreadsheet,
  FileIcon,
  File as FilePdf,
  Search,
  Filter,
  Grid,
  List,
  HardDrive,
  AlertCircle
} from 'lucide-react'
import type { Attachment } from '@/types'

interface AttachmentManagerProps {
  todoId: string
  attachments: Attachment[]
  onAttachmentAdded: (attachment: Attachment) => void
  onAttachmentDeleted: (attachmentId: string) => void
  storageUsed?: number
  storageLimit?: number
}

export function AttachmentManager({
  todoId,
  attachments,
  onAttachmentAdded,
  onAttachmentDeleted,
  storageUsed = 0,
  storageLimit = 100 * 1024 * 1024 // 100MB
}: AttachmentManagerProps) {
  const { token } = useAuth()
  const [isUploading, setIsUploading] = useState(false)
  const [uploadProgress, setUploadProgress] = useState(0)
  const [dragOver, setDragOver] = useState(false)
  const [searchTerm, setSearchTerm] = useState('')
  const [viewMode, setViewMode] = useState<'grid' | 'list'>('grid')
  const fileInputRef = useRef<HTMLInputElement>(null)
  const dropZoneRef = useRef<HTMLDivElement>(null)

  // è¿‡æ»¤åçš„é™„ä»¶åˆ—è¡¨
  const filteredAttachments = attachments.filter(attachment =>
    attachment.originalName.toLowerCase().includes(searchTerm.toLowerCase())
  )

  // æ ¹æ®æ–‡ä»¶ç±»å‹è·å–å›¾æ ‡
  const getFileIcon = (fileType: string) => {
    if (fileType.includes('word') || fileType.includes('document')) {
      return <FileText className="w-8 h-8 text-blue-600" />
    } else if (fileType.includes('sheet') || fileType.includes('excel')) {
      return <FileSpreadsheet className="w-8 h-8 text-green-600" />
    } else if (fileType.includes('presentation') || fileType.includes('powerpoint')) {
      return <FileIcon className="w-8 h-8 text-orange-600" />
    } else if (fileType === 'application/pdf') {
      return <FilePdf className="w-8 h-8 text-red-600" />
    } else if (fileType === 'text/plain') {
      return <FileText className="w-8 h-8 text-gray-600" />
    }
    return <Paperclip className="w-8 h-8 text-gray-600" />
  }

  // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
  const formatFileSize = (bytes: number) => {
    if (bytes === 0) return '0 B'
    const k = 1024
    const sizes = ['B', 'KB', 'MB', 'GB']
    const i = Math.floor(Math.log(bytes) / Math.log(k))
    return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i]
  }

  // å¤„ç†æ‹–æ‹½äº‹ä»¶
  const handleDragOver = useCallback((e: React.DragEvent) => {
    e.preventDefault()
    setDragOver(true)
  }, [])

  const handleDragLeave = useCallback((e: React.DragEvent) => {
    e.preventDefault()
    setDragOver(false)
  }, [])

  const handleDrop = useCallback(async (e: React.DragEvent) => {
    e.preventDefault()
    setDragOver(false)

    const files = Array.from(e.dataTransfer.files)
    if (files.length > 0) {
      await handleMultipleFileUpload(files)
    }
  }, [])

  // å¤„ç†å¤šä¸ªæ–‡ä»¶ä¸Šä¼ 
  const handleMultipleFileUpload = async (files: File[]) => {
    const validFiles = files.filter(file => {
      const allowedTypes = [
        'application/msword',
        'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
        'application/vnd.ms-excel',
        'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
        'application/vnd.ms-powerpoint',
        'application/vnd.openxmlformats-officedocument.presentationml.presentation',
        'text/plain',
        'application/pdf'
      ]

      return allowedTypes.includes(file.type) && file.size <= 10 * 1024 * 1024
    })

    if (validFiles.length === 0) {
      alert('æ²¡æœ‰æœ‰æ•ˆçš„æ–‡ä»¶ã€‚è¯·ä¸Šä¼  Wordã€Excelã€PowerPointã€TXT æˆ– PDF æ–‡ä»¶ï¼Œä¸”æ–‡ä»¶å¤§å°ä¸è¶…è¿‡ 10MBã€‚')
      return
    }

    // æ£€æŸ¥å­˜å‚¨ç©ºé—´
    const totalSize = validFiles.reduce((sum, file) => sum + file.size, 0)
    if (storageUsed + totalSize > storageLimit) {
      alert(`å­˜å‚¨ç©ºé—´ä¸è¶³ã€‚éœ€è¦ ${formatFileSize(totalSize)}ï¼Œå‰©ä½™ ${formatFileSize(storageLimit - storageUsed)}`)
      return
    }

    for (const file of validFiles) {
      await handleSingleFileUpload(file)
    }
  }

  // å¤„ç†å•ä¸ªæ–‡ä»¶ä¸Šä¼ 
  const handleSingleFileUpload = async (file: File) => {
    setIsUploading(true)
    setUploadProgress(0)

    try {
      const formData = new FormData()
      formData.append('file', file)
      formData.append('todoId', todoId)

      // æ¨¡æ‹Ÿä¸Šä¼ è¿›åº¦
      const progressInterval = setInterval(() => {
        setUploadProgress(prev => {
          if (prev >= 90) {
            clearInterval(progressInterval)
            return prev
          }
          return prev + 10
        })
      }, 100)

      const response = await fetch('/api/attachments', {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${token}`
        },
        body: formData
      })

      clearInterval(progressInterval)
      setUploadProgress(100)

      if (response.ok) {
        const result = await response.json()
        onAttachmentAdded(result.attachment)
      } else {
        const errorData = await response.json()
        alert(`ä¸Šä¼ å¤±è´¥: ${errorData.error}`)
      }
    } catch (error) {
      console.error('æ–‡ä»¶ä¸Šä¼ å¤±è´¥:', error)
      alert('ä¸Šä¼ å¤±è´¥ï¼Œè¯·é‡è¯•')
    } finally {
      setTimeout(() => {
        setIsUploading(false)
        setUploadProgress(0)
      }, 500)
    }
  }

  // å¤„ç†æ–‡ä»¶ä¸Šä¼ 
  const handleFileUpload = async (event: React.ChangeEvent<HTMLInputElement>) => {
    event.preventDefault()
    event.stopPropagation()

    const files = Array.from(event.target.files || [])
    if (files.length > 0) {
      await handleMultipleFileUpload(files)
    }

    // æ¸…ç©ºæ–‡ä»¶è¾“å…¥
    if (fileInputRef.current) {
      fileInputRef.current.value = ''
    }
  }

  // å¤„ç†æ–‡ä»¶ä¸‹è½½
  const handleDownload = async (attachment: Attachment) => {
    try {
      const response = await fetch(`/api/attachments/${attachment.id}`, {
        headers: {
          'Authorization': `Bearer ${token}`
        }
      })

      if (response.ok) {
        const blob = await response.blob()
        const url = window.URL.createObjectURL(blob)
        const a = document.createElement('a')
        a.href = url
        a.download = attachment.originalName
        document.body.appendChild(a)
        a.click()
        window.URL.revokeObjectURL(url)
        document.body.removeChild(a)
      } else {
        const errorData = await response.json()
        alert(`ä¸‹è½½å¤±è´¥: ${errorData.error}`)
      }
    } catch (error) {
      console.error('æ–‡ä»¶ä¸‹è½½å¤±è´¥:', error)
      alert('ä¸‹è½½å¤±è´¥ï¼Œè¯·é‡è¯•')
    }
  }

  // å¤„ç†æ–‡ä»¶åˆ é™¤
  const handleDelete = async (attachment: Attachment) => {
    if (!confirm(`ç¡®å®šè¦åˆ é™¤æ–‡ä»¶ "${attachment.originalName}" å—ï¼Ÿ`)) {
      return
    }

    try {
      const response = await fetch(`/api/attachments/${attachment.id}`, {
        method: 'DELETE',
        headers: {
          'Authorization': `Bearer ${token}`
        }
      })

      if (response.ok) {
        onAttachmentDeleted(attachment.id)
      } else {
        const errorData = await response.json()
        alert(`åˆ é™¤å¤±è´¥: ${errorData.error}`)
      }
    } catch (error) {
      console.error('æ–‡ä»¶åˆ é™¤å¤±è´¥:', error)
      alert('åˆ é™¤å¤±è´¥ï¼Œè¯·é‡è¯•')
    }
  }

  const storageUsagePercentage = Math.round((storageUsed / storageLimit) * 100)

  return (
    <div className="space-y-6">
      {/* å­˜å‚¨ç©ºé—´æŒ‡ç¤ºå™¨ */}
      <Card className="p-4">
        <div className="flex items-center gap-3">
          <HardDrive className="w-5 h-5 text-blue-600" />
          <div className="flex-1">
            <div className="flex items-center justify-between mb-2">
              <span className="text-sm font-medium">å­˜å‚¨ç©ºé—´</span>
              <span className="text-sm text-gray-600">
                {formatFileSize(storageUsed)} / {formatFileSize(storageLimit)}
              </span>
            </div>
            <Progress
              value={storageUsagePercentage}
              className="h-2"
              indicatorClassName={storageUsagePercentage > 80 ? 'bg-red-500' : storageUsagePercentage > 60 ? 'bg-yellow-500' : 'bg-green-500'}
            />
          </div>
          {storageUsagePercentage > 80 && (
            <AlertCircle className="w-5 h-5 text-red-500" />
          )}
        </div>
      </Card>

      {/* ä¸Šä¼ åŒºåŸŸ */}
      <div
        ref={dropZoneRef}
        className={`border-2 border-dashed rounded-lg p-6 text-center transition-colors ${
          dragOver ? 'border-blue-500 bg-blue-50' : 'border-gray-300 hover:border-gray-400'
        }`}
        onDragOver={handleDragOver}
        onDragLeave={handleDragLeave}
        onDrop={handleDrop}
      >
        <input
          ref={fileInputRef}
          type="file"
          onChange={handleFileUpload}
          accept=".doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.pdf"
          multiple
          className="hidden"
          disabled={isUploading}
        />

        <div className="space-y-4">
          <div className="mx-auto w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center">
            <Upload className="w-6 h-6 text-gray-600" />
          </div>

          <div>
            <p className="text-lg font-medium">æ‹–æ‹½æ–‡ä»¶åˆ°è¿™é‡Œä¸Šä¼ </p>
            <p className="text-sm text-gray-500 mt-1">æˆ–è€…</p>
          </div>

          <Button
            onClick={(e) => {
              e.preventDefault()
              e.stopPropagation()
              fileInputRef.current?.click()
            }}
            disabled={isUploading}
            className="flex items-center gap-2 mx-auto"
          >
            {isUploading ? (
              <>
                <div className="w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin" />
                ä¸Šä¼ ä¸­...
              </>
            ) : (
              <>
                <Upload className="w-4 h-4" />
                é€‰æ‹©æ–‡ä»¶
              </>
            )}
          </Button>

          <p className="text-xs text-gray-500">
            æ”¯æŒ Wordã€Excelã€PowerPointã€TXTã€PDF æ ¼å¼ï¼Œå•ä¸ªæ–‡ä»¶æœ€å¤§ 10MB
          </p>
        </div>

        {/* ä¸Šä¼ è¿›åº¦æ¡ */}
        {isUploading && (
          <div className="mt-4">
            <Progress value={uploadProgress} className="h-2" />
            <p className="text-sm text-gray-600 mt-1">ä¸Šä¼ è¿›åº¦: {uploadProgress}%</p>
          </div>
        )}
      </div>

      {/* æœç´¢å’Œç­›é€‰ */}
      {attachments.length > 0 && (
        <div className="flex items-center gap-3">
          <div className="flex-1 relative">
            <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400" />
            <input
              type="text"
              placeholder="æœç´¢æ–‡ä»¶..."
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
              className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
          </div>

          <div className="flex items-center gap-2">
            <Button
              variant={viewMode === 'grid' ? 'default' : 'outline'}
              size="sm"
              onClick={() => setViewMode('grid')}
            >
              <Grid className="w-4 h-4" />
            </Button>
            <Button
              variant={viewMode === 'list' ? 'default' : 'outline'}
              size="sm"
              onClick={() => setViewMode('list')}
            >
              <List className="w-4 h-4" />
            </Button>
          </div>

          <Badge variant="secondary">
            {filteredAttachments.length} / {attachments.length} ä¸ªæ–‡ä»¶
          </Badge>
        </div>
      )}

      {/* é™„ä»¶åˆ—è¡¨ */}
      {filteredAttachments.length > 0 ? (
        <div className={viewMode === 'grid' ? 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4' : 'space-y-2'}>
          {filteredAttachments.map((attachment) => (
            <Card key={attachment.id} className={viewMode === 'grid' ? 'p-4' : 'p-3'}>
              <CardContent className="p-0">
                {viewMode === 'grid' ? (
                  // ç½‘æ ¼è§†å›¾
                  <div className="space-y-3">
                    <div className="flex justify-center">
                      {getFileIcon(attachment.fileType)}
                    </div>

                    <div className="text-center">
                      <p className="font-medium text-sm truncate" title={attachment.originalName}>
                        {attachment.originalName}
                      </p>
                      <p className="text-xs text-gray-500 mt-1">
                        {formatFileSize(attachment.fileSize)}
                      </p>
                      <p className="text-xs text-gray-400">
                        {new Date(attachment.createdAt).toLocaleDateString()}
                      </p>
                    </div>

                    <div className="flex justify-center gap-2">
                      <Button
                        onClick={() => handleDownload(attachment)}
                        variant="outline"
                        size="sm"
                        className="h-8 w-8 p-0"
                        title="ä¸‹è½½"
                      >
                        <Download className="w-4 h-4" />
                      </Button>

                      <Button
                        onClick={() => handleDelete(attachment)}
                        variant="outline"
                        size="sm"
                        className="h-8 w-8 p-0 text-red-600 hover:text-red-700"
                        title="åˆ é™¤"
                      >
                        <Trash2 className="w-4 h-4" />
                      </Button>
                    </div>
                  </div>
                ) : (
                  // åˆ—è¡¨è§†å›¾
                  <div className="flex items-center justify-between">
                    <div className="flex items-center gap-3 flex-1 min-w-0">
                      {getFileIcon(attachment.fileType)}

                      <div className="flex-1 min-w-0">
                        <p className="text-sm font-medium text-gray-900 truncate">
                          {attachment.originalName}
                        </p>
                        <p className="text-xs text-gray-500">
                          {formatFileSize(attachment.fileSize)} â€¢
                          {new Date(attachment.createdAt).toLocaleDateString()}
                        </p>
                      </div>
                    </div>

                    <div className="flex items-center gap-1 ml-2">
                      <Button
                        onClick={() => handleDownload(attachment)}
                        variant="ghost"
                        size="sm"
                        className="h-8 w-8 p-0 text-gray-500 hover:text-blue-600 hover:bg-blue-50"
                        title="ä¸‹è½½"
                      >
                        <Download className="w-4 h-4" />
                      </Button>

                      <Button
                        onClick={() => handleDelete(attachment)}
                        variant="ghost"
                        size="sm"
                        className="h-8 w-8 p-0 text-gray-500 hover:text-red-600 hover:bg-red-50"
                        title="åˆ é™¤"
                      >
                        <Trash2 className="w-4 h-4" />
                      </Button>
                    </div>
                  </div>
                )}
              </CardContent>
            </Card>
          ))}
        </div>
      ) : searchTerm ? (
        <div className="text-center py-8 text-gray-500">
          <Search className="w-12 h-12 mx-auto mb-4 text-gray-400" />
          <p className="font-medium mb-2">æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„æ–‡ä»¶</p>
          <p className="text-sm">å°è¯•å…¶ä»–æœç´¢å…³é”®è¯</p>
        </div>
      ) : (
        <div className="text-center py-8 text-gray-500 border-2 border-dashed border-gray-300 rounded-lg">
          <Paperclip className="w-12 h-12 mx-auto mb-4 text-gray-400" />
          <p className="font-medium mb-2">æš‚æ— é™„ä»¶</p>
          <p className="text-sm">æ‹–æ‹½æ–‡ä»¶æˆ–ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®ä¸ºè¿™ä¸ªä»»åŠ¡æ·»åŠ é™„ä»¶</p>
        </div>
      )}
    </div>
  )
}
```

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½å®ç°

### 1. å››è±¡é™è§†å›¾

#### Claude Code æç¤ºè¯ ğŸ“

```
è¯·å¸®æˆ‘åˆ›å»ºå››è±¡é™æ—¶é—´ç®¡ç†è§†å›¾é¡µé¢ï¼š
- Q1: ç´§æ€¥ä¸”é‡è¦ï¼ˆçº¢è‰²ï¼‰
- Q2: ä¸ç´§æ€¥ä½†é‡è¦ï¼ˆè“è‰²ï¼‰
- Q3: ç´§æ€¥ä½†ä¸é‡è¦ï¼ˆé»„è‰²ï¼‰
- Q4: ä¸ç´§æ€¥ä¸”ä¸é‡è¦ï¼ˆç°è‰²ï¼‰

éœ€è¦åŒ…å«ï¼š
1. 2x2ç½‘æ ¼å¸ƒå±€
2. ä»»åŠ¡æ‹–æ‹½åŠŸèƒ½
3. ä»»åŠ¡å¡ç‰‡å±•ç¤º
4. é™„ä»¶é¢„è§ˆåŠŸèƒ½
5. è±¡é™ç»Ÿè®¡
6. å“åº”å¼è®¾è®¡
```

### 2. æœˆå†è§†å›¾

#### Claude Code æç¤ºè¯ ğŸ“

```
è¯·å¸®æˆ‘åˆ›å»ºæœˆå†è§†å›¾é¡µé¢ï¼š
1. æœˆå†ç½‘æ ¼å¸ƒå±€
2. ä»»åŠ¡åœ¨å¯¹åº”æ—¥æœŸæ˜¾ç¤º
3. ä¸åŒä¼˜å…ˆçº§ä»»åŠ¡çš„é¢œè‰²åŒºåˆ†
4. ç‚¹å‡»æ—¥æœŸæŸ¥çœ‹è¯¦æƒ…
5. æœˆä»½åˆ‡æ¢åŠŸèƒ½
6. ä»Šå¤©é«˜äº®æ˜¾ç¤º

éœ€è¦ä½¿ç”¨date-fnsåº“å¤„ç†æ—¥æœŸã€‚
```

### 3. é™„ä»¶ç®¡ç†

#### Claude Code æç¤ºè¯ ğŸ“

```
è¯·å¸®æˆ‘åˆ›å»ºé™„ä»¶ç®¡ç†ç»„ä»¶ï¼š
1. æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½
2. æ–‡ä»¶ç±»å‹éªŒè¯
3. æ–‡ä»¶å¤§å°é™åˆ¶
4. ä¸Šä¼ è¿›åº¦æ˜¾ç¤º
5. æ–‡ä»¶åˆ—è¡¨å±•ç¤º
6. æ–‡ä»¶ä¸‹è½½å’Œåˆ é™¤

æ”¯æŒçš„æ–‡ä»¶ç±»å‹ï¼šWord, Excel, PPT, PDF, TXT
```

---

## ğŸ¨ æ ·å¼ä¸UIè®¾è®¡

### 1. UIç»„ä»¶åº“

#### Claude Code æç¤ºè¯ ğŸ“

```
è¯·å¸®æˆ‘åˆ›å»ºåŸºç¡€UIç»„ä»¶åº“ï¼š
1. Buttonç»„ä»¶ - ä¸åŒæ ·å¼å’Œå°ºå¯¸
2. Inputç»„ä»¶ - è¡¨å•è¾“å…¥
3. Cardç»„ä»¶ - å¡ç‰‡å®¹å™¨
4. Modalç»„ä»¶ - å¼¹çª—
5. Loadingç»„ä»¶ - åŠ è½½çŠ¶æ€
6. Toastç»„ä»¶ - æ¶ˆæ¯æç¤º

ä½¿ç”¨Tailwind CSSå’Œshadcn/uiè®¾è®¡è§„èŒƒã€‚
```

### 2. å¯¼èˆªç»„ä»¶

#### Claude Code æç¤ºè¯ ğŸ“

```
è¯·å¸®æˆ‘åˆ›å»ºå¯¼èˆªç»„ä»¶ï¼š
1. é¡¶éƒ¨å¯¼èˆªæ 
2. ä¾§è¾¹æ å¯¼èˆª
3. ç”¨æˆ·èœå•
4. å“åº”å¼æŠ˜å 
5. æ´»è·ƒçŠ¶æ€æ˜¾ç¤º
6. ç§»åŠ¨ç«¯é€‚é…
```

---

## âš™ï¸ éƒ¨ç½²é…ç½®

### 1. ç”Ÿäº§ç¯å¢ƒé…ç½®

#### Claude Code æç¤ºè¯ ğŸ“

```
è¯·å¸®æˆ‘é…ç½®ç”Ÿäº§ç¯å¢ƒï¼š
1. è®¾ç½®ç«¯å£ä¸º3005
2. é…ç½®ç¯å¢ƒå˜é‡
3. ä¼˜åŒ–æ„å»ºé…ç½®
4. è®¾ç½®å¯åŠ¨è„šæœ¬
5. æ•°æ®åº“ç”Ÿäº§é…ç½®
```

### 2. Next.jsé…ç½®

```javascript
// next.config.mjs
/** @type {import('next').NextConfig} */
const nextConfig = {
  reactStrictMode: true,
  port: 3005,
  images: {
    domains: ['localhost'],
  },
  env: {
    CUSTOM_KEY: process.env.CUSTOM_KEY,
  },
}

export default nextConfig
```

### 3. ç¯å¢ƒå˜é‡é…ç½®

```env
# .env.production
DATABASE_URL="file:./prod.db"
JWT_SECRET="your-production-jwt-secret"
NEXTAUTH_SECRET="your-production-nextauth-secret"
NEXTAUTH_URL="https://your-domain.com"
PORT=3005
NODE_ENV="production"
```

---

## ğŸ¤– Claude Code ä½¿ç”¨æŠ€å·§

### 1. é¡¹ç›®åˆå§‹åŒ–æç¤ºè¯æ¨¡æ¿

```text
è¯·å¸®æˆ‘åˆ›å»ºä¸€ä¸ª{é¡¹ç›®ç±»å‹}é¡¹ç›®ï¼Œè¦æ±‚ï¼š
- ä½¿ç”¨{æŠ€æœ¯æ ˆ}
- åŒ…å«{åŠŸèƒ½åˆ—è¡¨}
- éµå¾ª{è®¾è®¡è§„èŒƒ}

è¯·ç”Ÿæˆå®Œæ•´çš„{æ–‡ä»¶ç±»å‹}æ–‡ä»¶ã€‚
```

### 2. åŠŸèƒ½å¼€å‘æç¤ºè¯æ¨¡æ¿

```text
è¯·å¸®æˆ‘å®ç°{åŠŸèƒ½åç§°}åŠŸèƒ½ï¼š
1. éœ€è¦{å…·ä½“éœ€æ±‚}
2. åŒ…å«{æŠ€æœ¯è¦æ±‚}
3. ä½¿ç”¨{è®¾è®¡æ¨¡å¼}
4. è€ƒè™‘{è¾¹ç•Œæƒ…å†µ}

è¯·åˆ›å»ºç›¸å…³çš„APIè·¯ç”±å’Œå‰ç«¯ç»„ä»¶ã€‚
```

### 3. æ ·å¼è®¾è®¡æç¤ºè¯æ¨¡æ¿

```text
è¯·å¸®æˆ‘è®¾è®¡{ç»„ä»¶åç§°}ç»„ä»¶ï¼š
1. ä½¿ç”¨{è®¾è®¡é£æ ¼}
2. åŒ…å«{äº¤äº’æ•ˆæœ}
3. å“åº”å¼è®¾è®¡
4. æ— éšœç¢è®¿é—®
5. ä¸»é¢˜é€‚é…

è¯·ä½¿ç”¨Tailwind CSSå®ç°ã€‚
```

### 4. æ•°æ®åº“è®¾è®¡æç¤ºè¯æ¨¡æ¿

```text
è¯·å¸®æˆ‘è®¾è®¡{ä¸šåŠ¡åœºæ™¯}çš„æ•°æ®åº“æ¨¡å‹ï¼š
1. åŒ…å«{å®ä½“åˆ—è¡¨}
2. å®šä¹‰{å­—æ®µç±»å‹}
3. è®¾ç½®{å…³è”å…³ç³»}
4. æ·»åŠ {ç´¢å¼•çº¦æŸ}
5. è€ƒè™‘{æ•°æ®å®Œæ•´æ€§}

è¯·ç”ŸæˆPrisma schemaæ–‡ä»¶ã€‚
```

### 5. é”™è¯¯å¤„ç†æç¤ºè¯æ¨¡æ¿

```text
è¯·å¸®æˆ‘ä¼˜åŒ–{åŠŸèƒ½åç§°}çš„é”™è¯¯å¤„ç†ï¼š
1. æ·»åŠ {éªŒè¯è§„åˆ™}
2. å¤„ç†{å¼‚å¸¸æƒ…å†µ}
3. æä¾›{ç”¨æˆ·åé¦ˆ}
4. è®°å½•{é”™è¯¯æ—¥å¿—}
5. ä¼˜åŒ–{ç”¨æˆ·ä½“éªŒ}

è¯·æ›´æ–°ç›¸å…³ä»£ç ã€‚
```

---

## ğŸ“ å¼€å‘æœ€ä½³å®è·µ

### 1. ä»£ç ç»„ç»‡

```
src/
â”œâ”€â”€ app/              # Next.jsé¡µé¢
â”œâ”€â”€ components/       # Reactç»„ä»¶
â”‚   â”œâ”€â”€ ui/          # åŸºç¡€UIç»„ä»¶
â”‚   â””â”€â”€ features/    # åŠŸèƒ½ç»„ä»¶
â”œâ”€â”€ lib/             # å·¥å…·å‡½æ•°
â”œâ”€â”€ hooks/           # è‡ªå®šä¹‰Hooks
â”œâ”€â”€ types/           # TypeScriptç±»å‹
â””â”€â”€ styles/          # æ ·å¼æ–‡ä»¶
```

### 2. APIè®¾è®¡è§„èŒƒ

- ä½¿ç”¨RESTfulè®¾è®¡
- ç»Ÿä¸€çš„é”™è¯¯å¤„ç†
- å®Œæ•´çš„ç±»å‹å®šä¹‰
- é€‚å½“çš„HTTPçŠ¶æ€ç 
- è¯·æ±‚å‚æ•°éªŒè¯

### 3. å®‰å…¨æœ€ä½³å®è·µ

- JWTè®¤è¯
- å¯†ç åŠ å¯†
- è¾“å…¥éªŒè¯
- SQLæ³¨å…¥é˜²æŠ¤
- XSSé˜²æŠ¤

### 4. æ€§èƒ½ä¼˜åŒ–

- æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–
- å›¾ç‰‡æ‡’åŠ è½½
- ä»£ç åˆ†å‰²
- ç¼“å­˜ç­–ç•¥
- å“åº”å¼è®¾è®¡

---

## ğŸš€ éƒ¨ç½²æŒ‡å—

### 1. æœ¬åœ°éƒ¨ç½²

```bash
# å®‰è£…ä¾èµ–
npm install

# æ„å»ºé¡¹ç›®
npm run build

# å¯åŠ¨æœåŠ¡
npm start
```

### 2. Dockeréƒ¨ç½²

```dockerfile
FROM node:18-alpine
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production
COPY . .
RUN npm run build
EXPOSE 3005
CMD ["npm", "start"]
```

### 3. äº‘å¹³å°éƒ¨ç½²

- Vercel (æ¨è)
- Netlify
- AWS
- é˜¿é‡Œäº‘
- è…¾è®¯äº‘

---

## ğŸ“ å­¦ä¹ æ€»ç»“

é€šè¿‡è¿™ä¸ªé¡¹ç›®ï¼Œæ‚¨å°†å­¦ä¼šï¼š

1. **Next.js 14** - ç°ä»£åŒ–å…¨æ ˆReactæ¡†æ¶
2. **TypeScript** - ç±»å‹å®‰å…¨çš„JavaScript
3. **Prisma** - ç°ä»£åŒ–æ•°æ®åº“ORM
4. **JWTè®¤è¯** - æ— çŠ¶æ€ç”¨æˆ·è®¤è¯
5. **RESTful API** - æ ‡å‡†åŒ–APIè®¾è®¡
6. **Tailwind CSS** - å®ç”¨ä¼˜å…ˆçš„CSSæ¡†æ¶
7. **å“åº”å¼è®¾è®¡** - ç§»åŠ¨ç«¯é€‚é…
8. **æ•°æ®åº“è®¾è®¡** - å…³ç³»å‹æ•°æ®åº“å»ºæ¨¡
9. **æ–‡ä»¶ä¸Šä¼ ** - å¤šåª’ä½“æ–‡ä»¶å¤„ç†
10. **Claude Code** - AIè¾…åŠ©å¼€å‘

---

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤Issueå’ŒPull Requestï¼

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. æ¨é€åˆ°åˆ†æ”¯
5. åˆ›å»ºPull Request

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è·å–å¸®åŠ©ï¼š

1. æŸ¥çœ‹é¡¹ç›®æ–‡æ¡£
2. æœç´¢ç›¸å…³Issues
3. æäº¤æ–°çš„Issue
4. å‚ä¸ç¤¾åŒºè®¨è®º

---

**æœ€åæ›´æ–°**: 2025å¹´11æœˆ1æ—¥
**ä½œè€…**: å‡¤æ­Œ
**ç‰ˆæœ¬**: v1.0.0

> ğŸ‰ æ­å–œï¼æ‚¨å·²ç»å®Œæˆäº†ä½¿ç”¨Claude Codeå¼€å‘å…¨æ ˆå¾…åŠäº‹é¡¹ç®¡ç†ç³»ç»Ÿçš„å­¦ä¹ ã€‚ç°åœ¨æ‚¨å¯ä»¥å¼€å§‹æ„å»ºè‡ªå·±çš„é¡¹ç›®äº†ï¼
